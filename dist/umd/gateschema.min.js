!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports,require("big.js")):"function"==typeof define&&define.amd?define(["exports","big.js"],a):a(t.GateSchema={},t.Big)}(this,function(t,u){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u;var a=[{name:"r",add:function(){return this.required}},{name:"o",add:function(){return this.optional}},{name:"bool",add:function(){return this.boolean}},{name:"num",add:function(){return this.number}},{name:"str",add:function(){return this.string}},{name:"bin",add:function(){return this.binary}},{name:"cond",add:function(){var r=this;return function(t,a,e){var n=r.constructor;return r.switch(t,[{case:n.required,schema:a},{case:n.any,schema:e||n.any}])}}}];function F(t){return null!=t&&"object"==typeof t}function $(t){return Array.isArray(t)?t:t.constraints}var e,p=(e=Array.from)?function(t){return t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length}:function(t){return e(t).length};function c(t,e){var n,r=this,i=t.path,a=t.args,o=t.rootData,s=t.state,u=void 0===s?{}:s,c=t.options,d=a[0],l=d.length,h=this.getValue(i,o,i,u.values),f=function(a){a<l?(n=d[a],r.validate(h,{schema:n,path:i,rootData:o,state:u,options:c},function(t){t?f(++a):e(n)})):e()};f(0)}function d(t,r){var i=this,a=t.path,e=t.args,o=t.rootData,n=t.state,s=void 0===n?{}:n,u=t.options,c=e[0],d=e[1],l=d.length,h=this.getValue(c,o,a,s.values),f=function(a){if(a<l){var t=d[a],e=t.case,n=t.schema;i.validate(h,{schema:e,path:c,rootData:o,state:s,options:u},function(t){t?f(++a):r(n)})}else r()};f(0)}var o=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,s=[0,31,28,31,30,31,30,31,31,30,31,30,31],l=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,n=/t|\s/i,r=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,i=/\/|:/,h=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,f=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,g=/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,m=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,v=/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i;function y(t){var a=t.match(o);if(!a)return!1;var e,n=+a[1],r=+a[2],i=+a[3];return 1<=r&&r<=12&&1<=i&&i<=(2!==r||((e=n)%4!=0||e%100==0&&e%400!=0)?s[r]:29)}var D={date:y,"date-time":function(t){var a=t.split(n);return 2===a.length&&y(a[0])&&function(t,a){var e=t.match(l);if(!e)return!1;var n=+e[1],r=+e[2],i=+e[3],o=e[5];return(n<=23&&r<=59&&i<=59||23===n&&59===r&&60===i)&&(!a||o)}(a[1],!0)},email:function(t){return g.test(t)},hostname:function(t){return t.length<=255&&r.test(t)},ipv4:function(t){return m.test(t)},ipv6:function(t){return v.test(t)},uri:function(t){return i.test(t)&&h.test(t)},url:function(t){return f.test(t)}},b=[{name:"required",add:function(){var t=this.constraints[0];return!t||"optional"!==t&&"optional"!==t.name?this.constraints.unshift("required"):this.constraints.splice(0,1,"required"),this.lastConstraintIndex=0,this},validator:function(t,a,e){null==t?e(!0):e()}},{name:"optional",add:function(){var t=this.constraints[0];return!t||"required"!==t&&"required"!==t.name?this.constraints.unshift("optional"):this.constraints.splice(0,1,"optional"),this.lastConstraintIndex=0,this},validator:function(t,a,e){null==t?e(this.BREAK):e()}},{name:"boolean",validator:function(t,a,e){var n=a.path;e((a.state.types[n]="boolean")!=typeof t)}},{name:"number",validator:function(t,a,e){var n=a.path;a.state.types[n]="number";try{new u(t)}catch(t){return e(!0)}e()}},{name:"string",validator:function(t,a,e){var n=a.path;e((a.state.types[n]="string")!=typeof t)}},{name:"binary",validator:function(t,a,e){var n,r=a.path;return a.state.types[r]="binary","string"==typeof(n=t)&&/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(n)?e():"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?e():void e(!0)}},{isHighOrder:!0,name:"map",validator:function(a,t,e){var n=this,r=t.path,i=t.rootData,o=t.state,s=t.args,u=t.options;o.types[r]="map";var c=s[0],d=Object.keys(c),l=d.length,h=o.values,f=o.mapDefinitions;if(f[r]?f[r].push(c):(h[r]=a,f[r]=[c]),!F(a))return e(!0);var g,p,m=0,v=function(t){return t?e(t):m<l?(g=d[m++],p=c[g],n.validate(a[g],{schema:p,path:"/"===r?"/"+g:r+"/"+g,rootData:i,state:o,options:u},v)):e(t)};v()},getChildSchema:function(t,a){var e=t.childKey;a(t.args[0][e])}},{isHighOrder:!0,name:"list",validator:function(e,t,n){var r=this,i=t.path,o=t.rootData,s=t.state,a=t.args,u=t.options;if(!Array.isArray(e))return n(!0);s.types[i]="list";var c=0,d=e.length,l=a[0],h=function(t){if(t)return n(t);if(c<d){var a=c++;return r.validate(e[a],{schema:l,path:"/"===i?"/"+a:i+"/"+a,rootData:o,state:s,options:u},h)}return n(t)};h()}},{getMatchSchema:c,isHighOrder:!0,name:"oneOf",validator:function(t,a,e){var n=a.path,r=a.rootData,i=a.state,o=a.args,s=a.options;c.call(this,{path:n,args:o,rootData:r,state:i,options:s},function(t){t?e():e(!0)})}},{name:"any",validator:function(t,a,e){e()}},{isHighOrder:!0,name:"enum",validator:function(t,a,e){var n=a.args[0],r=void 0===n?{}:n;for(var i in r)if(r[i]===t)return e();var o=Object.keys(r),s=o.map(function(t){return r[t]});e({keys:JSON.stringify(o),values:JSON.stringify(s)})}},{isHighOrder:!0,name:"enumList",validator:function(t,a,n){var e=a.path,r=a.rootData,i=a.args,o=a.state,s=a.options,u=i[0],c=void 0===u?{}:u,d=[{keyword:"list",args:[[{keyword:"enum",args:[c]}]]}];this.validate(t,{schema:d,path:e,rootData:r,state:o,options:s},function(t){if(t){var a=Object.keys(c),e=a.map(function(t){return c[t]});return n({keys:a,values:e})}n()})}},{isHighOrder:!0,name:"value",validator:function(t,a,e){var n=a.args[0];return t!==n?e({value:n}):e()}},{isHighOrder:!0,name:"format",validator:function(t,a,e){var n=a.args[0],r=D[n];return r?r(t)?e():e({format:n}):e(new Error("no validator for format: "+n))}},{isHighOrder:!0,name:"pattern",add:function(){var n=this;return function(t,a){var e={keyword:"pattern"};if(t instanceof RegExp)e.args=[t.source,t.flags];else{if("string"!=typeof t)throw new Error("pattern should be an RegExp instance or RegExp source string");e.args=[t,a]}return n.add(e),n}},validator:function(t,a,e){var n,r=a.args;try{n=RegExp.apply(null,r)}catch(t){return e(new Error("invalid pattern"))}return e(!n.test(t))}},{isHighOrder:!0,name:"length",validator:function(t,a,e){var n,r,i,o,s,u,c=a.path,d=a.state,l=a.args,h=d.types[c];if(!h)return e(new Error("missing type declaration"));switch(h){case"string":n=p(t);break;case"list":n=t.length;break;case"binary":if("string"==typeof t){if(0<(n=t.length)){var f=t.indexOf("=");n=3*n/4-(-1<f?n-f:0)}}else n=t.byteLength;break;default:return e(new Error("can't use length constraint on type: "+h))}var g=l[0];if(Array.isArray(g))if(s=g[0],u=g[1],null!=s&&null!=u)(n<s||u<n)&&(r=!0,i="range");else if(null!=s)n<s&&(r=!0,i="min");else{if(null==u)return e(new Error("missing minLength or maxLength"));u<n&&(r=!0,i="max")}else n!==(o=g)&&(r=!0,i="match");if(r)return e({KEY:"length_"+h+"_"+i,length:o,maxLength:u,minLength:s,valueLength:n});e()}},{isHighOrder:!0,name:"len",validator:function(t,a,e){var n,r,i,o,s,u,c=a.path,d=a.state,l=a.args,h=d.types[c];if(!h)return e(new Error("missing type declaration"));switch(h){case"string":n=p(t);break;case"list":n=t.length;break;case"binary":if("string"==typeof t){if(0<(n=t.length)){var f=t.indexOf("=");n=3*n/4-(-1<f?n-f:0)}}else n=t.byteLength;break;default:return e(new Error("can't use length constraint on type: "+h))}var g=l[0];if(Array.isArray(g))if(s=g[0],u=g[1],null!=s&&null!=u)(n<s||u<n)&&(r=!0,i="range");else if(null!=s)n<s&&(r=!0,i="min");else{if(null==u)return e(new Error("missing minLength or maxLength"));u<n&&(r=!0,i="max")}else n!==(o=g)&&(r=!0,i="match");if(r)return e({KEY:"length_"+h+"_"+i,length:o,maxLength:u,minLength:s,valueLength:n});e()}},{isHighOrder:!0,name:"min",validator:function(t,a,e){a.path,a.state;var n=a.args,r=n[0],i=n[1],o=new u(t),s=new u(r);if(o.lt(s)||i&&o.eq(s))return e({KEY:i?"min_exclusive":"min",value:t,min:r,isExclusive:i});e()}},{isHighOrder:!0,name:"max",validator:function(t,a,e){a.path,a.state;var n=a.args,r=n[0],i=n[1],o=new u(t),s=new u(r);if(o.gt(s)||i&&o.eq(s))return e({KEY:i?"max_exclusive":"max",value:t,max:r,isExclusive:i});e()}},{name:"unique",validator:function(t,a,e){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(-1!==n.indexOf(o))return e(!0);n.push(o)}e()}},{isHighOrder:!0,name:"not",validator:function(t,a,e){var n=a.path,r=a.rootData,i=a.state,o=a.args,s=a.options,u=o[0];this.validate(t,{schema:u,path:n,rootData:r,state:i,options:s},function(t){t?e():e(!0)})}},{name:"notEmpty",validator:function(t,a,e){var n=typeof t;switch(!0){case"number"===n:e(0===t);break;case"string"===n:e(""===t);break;case Array.isArray(t):e(0===t.length);break;case F(t):e(0===Object.keys(t).length);break;default:e(null==t)}}},{isHighOrder:!0,name:"equal",validator:function(t,a,e){var n=a.path,r=a.rootData,i=a.state,o=a.args[0];return t!==this.getValue(o,r,n,i.values)?e({id:o}):e()}},{getMatchSchema:d,isHighOrder:!0,name:"switch",validator:function(a,t,e){var n=this,r=t.path,i=t.rootData,o=t.state,s=t.args,u=t.options;d.call(this,{args:s,path:r,rootData:i,state:o,options:u},function(t){t?n.validate(a,{schema:$(t),path:r,rootData:i,state:o,options:u},e):e()})}},{name:"allowAdditional",validator:function(t,a,e){var n=a.path;a.state.mapAllowAdditional[n]=!0,e()}},{isHighOrder:!0,name:"other",validator:function(t,a,e){e()}}];var x,w={$clone:function(t){void 0===t&&(t={});var a=t.pick,e=t.omit,n=JSON.parse(JSON.stringify(this)),r=a?o(function(t){return-1===a.indexOf(t)}):e?o(function(t){return-1<e.indexOf(t)}):function(){},i=function(t){t.forEach(function(t){"map"===t.keyword&&r(t.args[0]),"switch"===t.keyword&&t.args[1].forEach(function(t){i(t.schema)})})};function o(e){return function(t){for(var a in t)e(a)&&delete t[a]}}return i(n),new this.constructor({constraints:n})},$keys:function(){var a=[];return this.constraints.forEach(function(t){"map"===t.keyword?a=a.concat(Object.keys(t.args[0])):"switch"===t.keyword&&t.args[1].forEach(function(t){a=a.concat(t.schema.$keys())})}),a},$msg:function(t){var a=this.lastConstraintIndex,e=this.constraints,n=e[a];return n&&("string"==typeof n&&(n={keyword:n},e.splice(a,1,n)),n.msg=t),this},$get:function(t,a,e,n){return"function"==typeof a?(n=a,a=void 0):"function"==typeof e&&(n=e,e={}),this.constructor.getSchema(t,{rootData:a,options:e,rootSchema:this},n),this}},O=function(t){Object.assign(this,t)},_=(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var e in a)a.hasOwnProperty(e)&&(t[e]=a[e])},function(t,a){function e(){this.constructor=t}x(t,a),t.prototype=null===a?Object.create(a):(e.prototype=a.prototype,new e)});var E=function(){function u(t){void 0===t&&(t={});var a=t.constraints;void 0===a&&(a=this.initConstraints.slice()),this.constraints=a,Object.defineProperty(this,"lastConstraintIndex",{value:0,writable:!0})}return u.addAlias=function(t){var a=t.name,e=t.add,n=this,r=n.prototype;if(r[a])throw new Error("keyword "+a+" conflict");Object.defineProperty(n,a,{get:function(){return(new n)[a]}}),Object.defineProperty(r,a,{get:function(){return e.call(this)}})},u.addKeyword=function(t,a){var n=t.name,e=t.validator,r=t.getChildSchema,i=t.getMatchSchema,o=t.isAsync,s=this.prototype;if("length"===n)try{Object.defineProperty(this,n,{get:function(){return console.warn("[GateSchema Warn] `length` keyword has been deprecated, please use `len` instead"),(new this)[n]}}),Object.defineProperty(s,n,{get:function(){var e=this;return console.warn("[GateSchema Warn] `length` keyword has been deprecated, please use `len` instead"),function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];if(!t)throw new Error("arguments are required");return e.add({args:t,keyword:n})}}})}catch(t){}else Object.defineProperty(this,n,{get:function(){return(new this)[n]}}),Object.defineProperty(s,n,{get:this.createAddFunction(t)});a&&this.addMsgs(a),o&&(this._asyncKeywords[n]=!0),this._validators[n]=e,r&&(this._getChildSchema[n]=r),i&&(this._getMatchSchema[n]=i)},u.createAddFunction=function(t){var n=t.name,a=t.isHighOrder,e=t.add;return"function"==typeof e?e:a?function(){var e=this;return function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];if(!t)throw new Error("arguments are required");return e.add({args:t,keyword:n})}}:function(){return this.add(n)}},u.addMsgs=function(t){Object.assign(this.msgs,t)},u.resolvePath=function(t,a){if(0===t.indexOf("./"))t=a.slice(0,a.lastIndexOf("/"))+t.slice(1);else if(0===t.indexOf("../")){var e=t.split("../"),n=e.length;if(!(n<=a.split("/").length))throw new Error("Can't resolve "+a);t=a.split("/").slice(0,-n).concat(e[n-1]).join("/")}return t},u.getValue=function(t,a,e,n){if(void 0===n&&(n={}),"/"===t)return a;if(null!=e&&(t=this.resolvePath(t,e)),!Object.getOwnPropertyDescriptor(n,t)){var r=void 0,i=void 0,o=void 0,s=t.lastIndexOf("/");0<s?(r=t.slice(s+1),i=t.slice(0,s),o=u.getValue(i,a,null,n)):(r=t.slice(1),o=a),F(o)&&(n[t]=o[r])}return n[t]},u.getSchema=function(t,a,e){var g=this,p=a.options,n=a.rootSchema,m=a.rootData;if("/"===t)return e(n);var r,i=t.split("/").slice(1),v=function(t,a){var e,n,r,i,o,s=t.childKey,u=t.parentPath,c=t.schema,d=0,l=$(c),h=l.length,f=function(t){!t&&d<h?("object"==typeof(e=l[d++])?(n=e.keyword,r=e.args):(n=e,r=[]),i=g._getMatchSchema[n],o=g._getChildSchema[n],i?i.call(g,{path:u,args:r,rootData:m,state:F,options:p},function(t){t?v({childKey:s,parentPath:u,schema:t},f):f()}):o?o.call(g,{args:r,childKey:s},f):f()):a(t)};f()},o=0,s="",u=i.length,F={mapAllowAdditional:{},mapDefinitions:{},types:{},values:{},cache:{}},c=function(t){t?o<u?(s+=r?"/"+r:"/",r=i[o++],v({childKey:r,parentPath:s,schema:t},c)):e(Array.isArray(t)?new g({constraints:t}):t):e()};c(n)},u.extend=function(t){void 0===t&&(t={});var a=t.defaultOptions,e=t.initConstraints,n=t.keywords,r=t.aliases,i=t.msgs,o=this,s=function(t){function a(){return null!==t&&t.apply(this,arguments)||this}return _(a,t),a}(o);Object.assign(s,o),s.msgs=Object.create(o.msgs),s._validators=Object.create(o._validators),s._getChildSchema=Object.create(o._getChildSchema),s._getMatchSchema=Object.create(o._getMatchSchema);var u=s.prototype;return a&&(u.defaultOptions=a),e&&(u.initConstraints=e),Array.isArray(n)&&n.forEach(function(t){s.addKeyword(t)}),Array.isArray(r)&&r.forEach(function(t){s.addAlias(t)}),i&&s.addMsgs(i),s},u.getMsg=function(t){return this.msgs[t]},u.createError=function(t,a,e,n){var r=n.constraint,i={keyword:t,msgParams:e,path:n.path,value:a},o=r.msg||this.getMsg(e.KEY);return i.msg=this.formatMsg(o,e,r)||"invalid value",new this.Error(i)},u.formatMsg=function(t,e,a){return t&&-1<t.indexOf("${")&&(t=t.replace(/\$\{(.+?)\}/g,function(t,a){return e[a]})),t},u.validate=function(e,t,n){var r=this,o=t.path,i=t.rootData,s=t.schema,u=t.state,a=t.options,c=void 0===a?{}:a,d=this._validators,l=this.BREAK,h=this.Error,f=this._asyncKeywords,g=c.removeAdditional,p=c.skips,m=c.skipAsync;if(c.useCache){var v=function(t,a,e){var n=e.cache;if(void 0!==n[t]){var r=n[t].find(function(t){return t[0]===a});if(r)return r[1]}}(o,s,u);if(v)return n(v);var F=n;n=function(t){var a,e,n,r,i;a=t,e=o,n=s,r=u.cache,i=[n,a],r[e]?r[e].push(i):r[e]=[i],F(t)}}var y,D,b,x,w,O=$(s),_=O.length,E=0,A=function(t){if(t){switch(!0){case t===l:w=l;break;case t instanceof h:w=t;break;case t instanceof Error:throw t;default:var a=!0===t?{}:t;a.KEY||(a.KEY=x),w=r.createError(x,e,a,{constraint:y,path:o,rootData:i,state:u})}n(w)}else E<_?(y=O[E++],x="string"==typeof y?y:y.keyword,m&&f[x]&&A(),D=y.args,(b=d[x])?b.call(r,e,{args:D,path:o,rootData:i,state:u,options:c},A):p&&-1<p.indexOf(x)?A():n(new Error("no validator for keyword: "+x+", constraint: "+JSON.stringify(y)))):(g&&function(t,a){var e=a.values,n=a.mapAllowAdditional,r=a.mapDefinitions[t];if(r&&!n[t]){var i=e[t],o=r.reduce(function(t,a){return t.push.apply(t,Object.keys(a)),t},[]);for(var s in i)-1===o.indexOf(s)&&delete i[s]}}(o,u),n(null))};A()},u.prototype.add=function(t){return this.lastConstraintIndex=this.constraints.length,this.constraints.push(t),this},u.prototype.validate=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var n=arguments[0],e=arguments[1],r=arguments[2],i=this.constructor;"function"==typeof e&&(r=e,e=void 0),null==e&&(e=this.defaultOptions);var o={schema:this.constraints,path:"/",rootData:n,state:{mapAllowAdditional:{},mapDefinitions:{},types:{},values:{},cache:{}},options:e};if("function"!=typeof r)return new Promise(function(a,e){i.validate(n,o,function(t){return(t=t===i.BREAK?null:t)?e(t):a(t)})});i.validate(n,o,function(t){r(t===i.BREAK?null:t)})},u.prototype.toJSON=function(){return JSON.parse(JSON.stringify(this.constraints))},u.BREAK=Symbol("break"),u.msgs={},u._asyncKeywords={},u._validators={},u._getMatchSchema={},u._getChildSchema={},u.Error=O,u}();E.prototype.defaultOptions={},E.prototype.initConstraints=[];var A=E.extend({aliases:a,keywords:b,msgs:{binary:"should be binary",boolean:"should be true or false",number:"should be a number",string:"should be a string",list:"should be an list",map:"should be a map",enum:"should be one of ${values}",enumList:"should be a list only containing these values: ${values}",not:"invalid value",equal:"should equal to the value of ${id}",format:"invalid ${format} format",length_string_match:"should contain ${length} characters",length_string_min:"should contain at least ${maxLength} characters",length_string_max:"should contain at most ${maxLength} characters",length_string_range:"should contain ${minLength} to ${maxLength} characters",length_list_match:"should contain ${length} items",length_list_min:"should contain at least ${minLength} items",length_list_max:"should contain at most ${maxLength} items",length_list_range:"should contain ${minLength} to ${maxLength} items",length_binary_match:"should contain ${length} bytes",length_binary_min:"should contain at least ${minLength} bytes",length_binary_max:"should contain at most ${maxLength} bytes",length_binary_range:"should contain ${minLength} to ${maxLength} bytes",max:"should be less than or equal to ${max}",max_exclusive:"should be less than ${max}",min:"should be greater than or equal to ${min}",min_exclusive:"should be greater than ${min}",notEmpty:"should not be empty",oneOf:"invalid value",pattern:"invalid format",required:"should not be null or undefined",requiredOne:"at least one field of ${keys} could not be undefined or null",switch:"no matching case",unique:"each element should be unique",value:"should be ${value}"}}),k=A.extend({initConstraints:["required"]}),C=A.extend({initConstraints:["optional"]});Object.assign(E.prototype,w),t._=A,t.r=k,t.o=C,t.default=A,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=gateschema.min.js.map
